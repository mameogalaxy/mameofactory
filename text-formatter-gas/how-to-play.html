<div id="howToPlayModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.95);z-index:10001;overflow-y:auto;padding:20px">
<div style="max-width:900px;margin:0 auto;background:linear-gradient(135deg,#1e3a8a,#06b6d4);border-radius:20px;padding:30px;position:relative;box-shadow:0 20px 60px rgba(0,0,0,0.5)">
<button onclick="closeHowToPlay()" style="position:absolute;top:15px;right:15px;background:#f59e0b;color:#fff;border:none;border-radius:50%;width:40px;height:40px;font-size:1.5rem;cursor:pointer;font-weight:bold;box-shadow:0 4px 10px rgba(0,0,0,0.3)">×</button>

<h1 style="color:#fff;text-align:center;margin:0 0 30px 0;font-size:2rem;text-shadow:2px 2px 4px rgba(0,0,0,0.5)">遊び方ガイド</h1>

<!-- セクション1: 基本操作 -->
<div style="background:rgba(255,255,255,0.95);border-radius:15px;padding:25px;margin-bottom:20px;box-shadow:0 4px 15px rgba(0,0,0,0.2)">
<h2 style="color:#3b82f6;margin:0 0 20px 0;font-size:1.5rem;border-bottom:3px solid #3b82f6;padding-bottom:10px">基本操作</h2>

<!-- SVG図解: カメラ位置 -->
<div style="background:linear-gradient(135deg,#1a1a1a,#2d2d2d);border-radius:10px;padding:20px;margin:20px 0;box-shadow:inset 0 2px 10px rgba(0,0,0,0.5)">
<svg viewBox="0 0 400 450" style="width:100%;max-width:400px;margin:0 auto;display:block">
<defs>
<linearGradient id="screenGrad" x1="0%" y1="0%" x2="0%" y2="100%">
<stop offset="0%" style="stop-color:#2d3748;stop-opacity:1" />
<stop offset="100%" style="stop-color:#1a202c;stop-opacity:1" />
</linearGradient>
<filter id="glow">
<feGaussianBlur stdDeviation="3" result="coloredBlur"/>
<feMerge>
<feMergeNode in="coloredBlur"/>
<feMergeNode in="SourceGraphic"/>
</feMerge>
</filter>
<radialGradient id="faceGrad">
<stop offset="0%" style="stop-color:#ffd700;stop-opacity:1" />
<stop offset="100%" style="stop-color:#ffa500;stop-opacity:1" />
</radialGradient>
</defs>
<rect width="400" height="450" fill="url(#screenGrad)" rx="10"/>
<text x="200" y="30" fill="#fff" font-size="16" text-anchor="middle" font-weight="bold" filter="url(#glow)">ゲーム画面</text>
<circle cx="200" cy="130" r="45" fill="url(#faceGrad)" filter="url(#glow)"/>
<circle cx="185" cy="120" r="8" fill="#000"/>
<circle cx="215" cy="120" r="8" fill="#000"/>
<path d="M 185 145 Q 200 155 215 145" stroke="#000" stroke-width="3" fill="none"/>
<line x1="50" y1="200" x2="350" y2="200" stroke="#fff" stroke-width="4" stroke-dasharray="15,8" filter="url(#glow)"/>
<rect x="30" y="380" width="30" height="4" fill="#fff" opacity="0.8"/>
<rect x="65" y="380" width="15" height="4" fill="#fff" opacity="0.8"/>
<rect x="85" y="380" width="30" height="4" fill="#fff" opacity="0.8"/>
<rect x="120" y="380" width="15" height="4" fill="#fff" opacity="0.8"/>
<text x="145" y="385" fill="#fff" font-size="13" font-weight="bold">白い点線：顎を合わせる</text>
<line x1="50" y1="270" x2="350" y2="270" stroke="#eab308" stroke-width="4" filter="url(#glow)"/>
<rect x="30" y="405" width="50" height="4" fill="#eab308"/>
<text x="90" y="410" fill="#eab308" font-size="13" font-weight="bold">黄色い線：ダメージ 2</text>
<line x1="50" y1="340" x2="350" y2="340" stroke="#ef4444" stroke-width="4" filter="url(#glow)"/>
<rect x="30" y="430" width="50" height="4" fill="#ef4444"/>
<text x="90" y="435" fill="#ef4444" font-size="13" font-weight="bold">赤い線：ダメージ 3</text>
<path d="M 200 175 L 200 195" stroke="#22c55e" stroke-width="5" marker-end="url(#arrowgreen)" filter="url(#glow)"/>
<text x="200" y="220" fill="#22c55e" font-size="14" text-anchor="middle" font-weight="bold" filter="url(#glow)">顎をここに</text>
<defs><marker id="arrowgreen" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto"><polygon points="0,0 10,5 0,10" fill="#22c55e"/></marker></defs>
</svg>
</div>

<div style="background:#f0f9ff;border:3px solid #3b82f6;border-radius:10px;padding:15px;margin:15px 0">
<p style="margin:0 0 10px 0;font-size:1.1rem;font-weight:bold;color:#1e40af">STEP 1: カメラ位置を調整</p>
<p style="margin:0 0 10px 0;line-height:1.6">顔を画面に映し、<span style="background:#fef3c7;padding:2px 8px;border-radius:4px;font-weight:bold">顎を一番上の白い点線</span>に合わせます</p>
<p style="margin:10px 0 0 0;line-height:1.6;font-size:0.9rem;color:#64748b">※ 線は顔を検出すると自動的に表示されます</p>
</div>

<!-- SVG図解: スクワット動作 -->
<div style="background:linear-gradient(135deg,#1a1a1a,#2d2d2d);border-radius:10px;padding:20px;margin:20px 0;box-shadow:inset 0 2px 10px rgba(0,0,0,0.5)">
<svg viewBox="0 0 420 280" style="width:100%;max-width:420px;margin:0 auto;display:block">
<defs>
<linearGradient id="bgGrad" x1="0%" y1="0%" x2="0%" y2="100%">
<stop offset="0%" style="stop-color:#2d3748;stop-opacity:1" />
<stop offset="100%" style="stop-color:#1a202c;stop-opacity:1" />
</linearGradient>
</defs>
<rect width="420" height="280" fill="url(#bgGrad)" rx="10"/>
<text x="210" y="30" fill="#fff" font-size="16" text-anchor="middle" font-weight="bold" filter="url(#glow)">スクワット動作</text>
<circle cx="110" cy="90" r="35" fill="url(#faceGrad)" filter="url(#glow)"/>
<circle cx="95" cy="82" r="7" fill="#000"/>
<circle cx="125" cy="82" r="7" fill="#000"/>
<line x1="30" y1="125" x2="190" y2="125" stroke="#fff" stroke-width="3" stroke-dasharray="10,5" filter="url(#glow)"/>
<path d="M 110 125 L 110 210" stroke="#22c55e" stroke-width="6" marker-end="url(#arrow1)" filter="url(#glow)"/>
<text x="110" y="235" fill="#22c55e" font-size="16" text-anchor="middle" font-weight="bold" filter="url(#glow)">下げる</text>
<circle cx="310" cy="200" r="35" fill="url(#faceGrad)" filter="url(#glow)"/>
<circle cx="295" cy="192" r="7" fill="#000"/>
<circle cx="325" cy="192" r="7" fill="#000"/>
<line x1="230" y1="125" x2="390" y2="125" stroke="#fff" stroke-width="3" stroke-dasharray="10,5" filter="url(#glow)"/>
<line x1="230" y1="235" x2="390" y2="235" stroke="#eab308" stroke-width="3" filter="url(#glow)"/>
<path d="M 310 125 L 310 60" stroke="#3b82f6" stroke-width="6" marker-end="url(#arrow2)" filter="url(#glow)"/>
<text x="310" y="50" fill="#3b82f6" font-size="16" text-anchor="middle" font-weight="bold" filter="url(#glow)">戻る</text>
<text x="210" y="265" fill="#fff" font-size="14" text-anchor="middle" filter="url(#glow)">1回カウント</text>
<defs><marker id="arrow1" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto"><polygon points="0,0 10,5 0,10" fill="#22c55e"/></marker><marker id="arrow2" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto"><polygon points="0,0 10,5 0,10" fill="#3b82f6"/></marker></defs>
</svg>
</div>

<div style="background:#f0f9ff;border:3px solid #3b82f6;border-radius:10px;padding:15px;margin:15px 0">
<p style="margin:0 0 10px 0;font-size:1.1rem;font-weight:bold;color:#1e40af">STEP 2: スクワット動作</p>
<p style="margin:0 0 10px 0;line-height:1.6">顎を下げて<span style="background:#fef3c7;padding:2px 8px;border-radius:4px;font-weight:bold">黄色または赤の線</span>まで下げます</p>
<ul style="margin:10px 0;padding-left:20px">
<li><span style="color:#eab308;font-weight:bold">黄色の線</span>: ダメージ 2</li>
<li><span style="color:#ef4444;font-weight:bold">赤の線</span>: ダメージ 3</li>
</ul>
</div>

<!-- SVG図解: ダメージ計算 -->
<div style="background:#fff;border-radius:10px;padding:20px;margin:20px 0;text-align:center;box-shadow:0 2px 10px rgba(0,0,0,0.1)">
<svg viewBox="0 0 380 140" style="width:100%;max-width:380px;margin:0 auto;display:block">
<defs>
<linearGradient id="boxGrad1" x1="0%" y1="0%" x2="0%" y2="100%">
<stop offset="0%" style="stop-color:#dbeafe;stop-opacity:1" />
<stop offset="100%" style="stop-color:#bfdbfe;stop-opacity:1" />
</linearGradient>
<linearGradient id="boxGrad2" x1="0%" y1="0%" x2="0%" y2="100%">
<stop offset="0%" style="stop-color:#fef3c7;stop-opacity:1" />
<stop offset="100%" style="stop-color:#fde68a;stop-opacity:1" />
</linearGradient>
<linearGradient id="boxGrad3" x1="0%" y1="0%" x2="0%" y2="100%">
<stop offset="0%" style="stop-color:#dcfce7;stop-opacity:1" />
<stop offset="100%" style="stop-color:#bbf7d0;stop-opacity:1" />
</linearGradient>
</defs>
<rect x="15" y="25" width="110" height="90" fill="url(#boxGrad1)" stroke="#3b82f6" stroke-width="3" rx="10"/>
<text x="70" y="50" fill="#1e40af" font-size="13" text-anchor="middle" font-weight="bold">基本ダメージ</text>
<text x="70" y="80" fill="#ef4444" font-size="28" text-anchor="middle" font-weight="bold">1-3</text>
<text x="145" y="75" fill="#000" font-size="24" font-weight="bold">+</text>
<rect x="170" y="25" width="100" height="90" fill="url(#boxGrad2)" stroke="#f59e0b" stroke-width="3" rx="10"/>
<text x="220" y="50" fill="#92400e" font-size="13" text-anchor="middle" font-weight="bold">レベル-1</text>
<text x="220" y="80" fill="#f59e0b" font-size="28" text-anchor="middle" font-weight="bold">0-99</text>
<text x="290" y="75" fill="#000" font-size="24" font-weight="bold">=</text>
<rect x="310" y="25" width="60" height="90" fill="url(#boxGrad3)" stroke="#22c55e" stroke-width="3" rx="10"/>
<text x="340" y="80" fill="#15803d" font-size="32" text-anchor="middle" font-weight="bold">MAX</text>
</svg>
</div>

<div style="background:#dcfce7;border:3px solid #22c55e;border-radius:10px;padding:15px;margin:15px 0">
<p style="margin:0;font-size:1rem;font-weight:bold;color:#15803d">ポイント</p>
<p style="margin:5px 0 0 0;line-height:1.6">深くしゃがむほど大ダメージ。レベルが上がるとさらに強くなります</p>
</div>
</div>

<!-- セクション2: 戦闘システム -->
<div style="background:rgba(255,255,255,0.95);border-radius:15px;padding:25px;margin-bottom:20px;box-shadow:0 4px 15px rgba(0,0,0,0.2)">
<h2 style="color:#22c55e;margin:0 0 20px 0;font-size:1.5rem;border-bottom:3px solid #22c55e;padding-bottom:10px">戦闘システム</h2>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin:15px 0">
<div style="background:linear-gradient(135deg,#f0fdf4,#dcfce7);border:2px solid #22c55e;border-radius:10px;padding:20px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,0.1)">
<p style="margin:0 0 5px 0;font-size:2.5rem">⚔</p>
<p style="margin:0;font-weight:bold;color:#15803d">敵のHPを0に</p>
</div>
<div style="background:linear-gradient(135deg,#f0fdf4,#dcfce7);border:2px solid #22c55e;border-radius:10px;padding:20px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,0.1)">
<p style="margin:0 0 5px 0;font-size:2.5rem">★</p>
<p style="margin:0;font-weight:bold;color:#15803d">ステージクリア</p>
</div>
</div>
<p style="margin:15px 0;line-height:1.6">敵を倒すと<span style="background:#fef3c7;padding:2px 8px;border-radius:4px;font-weight:bold">経験値</span>と<span style="background:#fef3c7;padding:2px 8px;border-radius:4px;font-weight:bold">宝箱</span>がドロップ</p>
<div style="background:#fef3c7;border-left:4px solid #f59e0b;padding:15px;margin:15px 0">
<p style="margin:0;font-weight:bold;color:#92400e">注意: ステージが進むほど敵が強くなります</p>
</div>
</div>

<!-- セクション3: レベルアップ -->
<div style="background:rgba(255,255,255,0.95);border-radius:15px;padding:25px;margin-bottom:20px;box-shadow:0 4px 15px rgba(0,0,0,0.2)">
<h2 style="color:#f59e0b;margin:0 0 20px 0;font-size:1.5rem;border-bottom:3px solid #f59e0b;padding-bottom:10px">レベルアップ</h2>
<div style="background:#fffbeb;border:3px solid #f59e0b;border-radius:10px;padding:15px;margin:15px 0">
<p style="margin:0 0 10px 0;font-size:1.1rem;font-weight:bold;color:#92400e">経験値を貯めてレベルアップ</p>
<ul style="margin:10px 0;padding-left:20px;line-height:1.8">
<li>レベルが上がると<span style="font-weight:bold;color:#dc2626">攻撃力アップ</span></li>
<li>最大レベル: <span style="font-weight:bold">100</span></li>
<li>モンスターごとにレベルを保存</li>
</ul>
</div>
<div style="text-align:center;margin:15px 0">
<div style="display:inline-block;background:linear-gradient(135deg,#fef3c7,#fde68a);border:2px solid #f59e0b;border-radius:10px;padding:15px 25px;box-shadow:0 2px 8px rgba(0,0,0,0.1)">
<p style="margin:0;font-size:0.9rem;color:#92400e">ダメージ計算式</p>
<p style="margin:5px 0 0 0;font-size:1.3rem;font-weight:bold;color:#dc2626">基本ダメージ + (レベル - 1)</p>
</div>
</div>
</div>

<!-- セクション4: ガチャシステム -->
<div style="background:rgba(255,255,255,0.95);border-radius:15px;padding:25px;margin-bottom:20px;box-shadow:0 4px 15px rgba(0,0,0,0.2)">
<h2 style="color:#a855f7;margin:0 0 20px 0;font-size:1.5rem;border-bottom:3px solid #a855f7;padding-bottom:10px">ガチャシステム</h2>
<div style="background:#faf5ff;border:3px solid #a855f7;border-radius:10px;padding:15px;margin:15px 0">
<p style="margin:0 0 10px 0;font-size:1.1rem;font-weight:bold;color:#7e22ce">宝箱を開けてモンスターをゲット</p>
<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin:15px 0">
<div style="background:linear-gradient(135deg,#fff,#f5f5dc);border:2px solid #CD7F32;border-radius:8px;padding:15px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,0.1)">
<p style="margin:0;font-size:0.9rem;font-weight:bold;color:#8B4513">ブロンズ</p>
</div>
<div style="background:linear-gradient(135deg,#fff,#f0f0f0);border:2px solid #C0C0C0;border-radius:8px;padding:15px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,0.1)">
<p style="margin:0;font-size:0.9rem;font-weight:bold;color:#666">シルバー</p>
</div>
<div style="background:linear-gradient(135deg,#fff,#fef3c7);border:2px solid #FFD700;border-radius:8px;padding:15px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,0.1)">
<p style="margin:0;font-size:0.9rem;font-weight:bold;color:#B8860B">ゴールド</p>
</div>
</div>
</div>
<div style="background:#dcfce7;border-left:4px solid #22c55e;padding:15px;margin:15px 0">
<p style="margin:0;font-weight:bold;color:#15803d">モンスターを集めて図鑑をコンプリート</p>
</div>
</div>

<!-- セクション5: 顔マスク機能 -->
<div style="background:rgba(255,255,255,0.95);border-radius:15px;padding:25px;margin-bottom:20px;box-shadow:0 4px 15px rgba(0,0,0,0.2)">
<h2 style="color:#8b5cf6;margin:0 0 20px 0;font-size:1.5rem;border-bottom:3px solid #8b5cf6;padding-bottom:10px">顔マスク機能</h2>
<div style="background:#f5f3ff;border:3px solid #8b5cf6;border-radius:10px;padding:15px;margin:15px 0">
<p style="margin:0 0 10px 0;font-size:1.1rem;font-weight:bold;color:#5b21b6">プライバシー保護</p>
<ul style="margin:10px 0;padding-left:20px;line-height:1.8">
<li>好きな画像をアップロードして顔を隠せます</li>
<li>マスクのサイズを調整可能</li>
<li>ON/OFF切り替えが簡単</li>
</ul>
</div>
<div style="background:#dbeafe;border-left:4px solid #3b82f6;padding:15px;margin:15px 0">
<p style="margin:0;font-weight:bold;color:#1e40af">使い方: ゲーム画面の「顔マスク」ボタンから設定</p>
</div>
</div>

<!-- セクション6: BGM機能 -->
<div style="background:rgba(255,255,255,0.95);border-radius:15px;padding:25px;margin-bottom:20px;box-shadow:0 4px 15px rgba(0,0,0,0.2)">
<h2 style="color:#ec4899;margin:0 0 20px 0;font-size:1.5rem;border-bottom:3px solid #ec4899;padding-bottom:10px">BGM機能</h2>
<div style="background:#fdf2f8;border:3px solid #ec4899;border-radius:10px;padding:15px;margin:15px 0">
<p style="margin:0 0 10px 0;font-size:1.1rem;font-weight:bold;color:#9f1239">ゲームを盛り上げる音楽</p>
<ul style="margin:10px 0;padding-left:20px;line-height:1.8">
<li>パンプキンナイトのテーマ曲を再生</li>
<li>ワンタッチでON/OFF切り替え</li>
<li>スマホのメディアコントロールに対応</li>
</ul>
</div>
<div style="background:#dbeafe;border-left:4px solid #3b82f6;padding:15px;margin:15px 0">
<p style="margin:0;font-weight:bold;color:#1e40af">使い方: ゲーム画面右上の「BGM」ボタンから設定</p>
</div>
</div>

<!-- セクション7: データ保存 -->
<div style="background:rgba(255,255,255,0.95);border-radius:15px;padding:25px;margin-bottom:20px;box-shadow:0 4px 15px rgba(0,0,0,0.2)">
<h2 style="color:#ef4444;margin:0 0 20px 0;font-size:1.5rem;border-bottom:3px solid #ef4444;padding-bottom:10px">データ保存</h2>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin:15px 0">
<div style="background:linear-gradient(135deg,#fef2f2,#fee2e2);border:2px solid #ef4444;border-radius:10px;padding:15px">
<p style="margin:0 0 10px 0;font-size:1.1rem;font-weight:bold;color:#991b1b">ゲストモード</p>
<ul style="margin:0;padding-left:20px;font-size:0.9rem;line-height:1.6">
<li>レベルは毎回リセット</li>
<li>ランキング参加可能</li>
<li>すぐに遊べる</li>
</ul>
</div>
<div style="background:linear-gradient(135deg,#dcfce7,#bbf7d0);border:2px solid #22c55e;border-radius:10px;padding:15px">
<p style="margin:0 0 10px 0;font-size:1.1rem;font-weight:bold;color:#15803d">ログインモード</p>
<ul style="margin:0;padding-left:20px;font-size:0.9rem;line-height:1.6">
<li>モンスターを育成可能</li>
<li>入れ替えてもレベル引き継ぎ</li>
<li>進行状況を保存</li>
<li>ランキング参加</li>
</ul>
</div>
</div>
<div style="background:#dbeafe;border-left:4px solid #3b82f6;padding:15px;margin:15px 0">
<p style="margin:0;font-weight:bold;color:#1e40af">重要: ゲストモードでもランキングには参加できますが、モンスターの育成はログインモードのみ可能です</p>
</div>
</div>

<!-- セクション8: ボタン説明 -->
<div style="background:rgba(255,255,255,0.95);border-radius:15px;padding:25px;box-shadow:0 4px 15px rgba(0,0,0,0.2)">
<h2 style="color:#3b82f6;margin:0 0 20px 0;font-size:1.5rem;border-bottom:3px solid #3b82f6;padding-bottom:10px">ボタン説明</h2>
<div style="display:grid;gap:10px">
<div style="background:linear-gradient(135deg,#f0f9ff,#dbeafe);border-left:4px solid #3b82f6;padding:12px;border-radius:5px">
<span style="font-weight:bold;color:#1e40af">スコア保存:</span> 現在の記録を保存
</div>
<div style="background:linear-gradient(135deg,#f0fdf4,#dcfce7);border-left:4px solid #22c55e;padding:12px;border-radius:5px">
<span style="font-weight:bold;color:#15803d">アイテム:</span> 宝箱を開けてガチャ
</div>
<div style="background:linear-gradient(135deg,#fef3c7,#fde68a);border-left:4px solid #f59e0b;padding:12px;border-radius:5px">
<span style="font-weight:bold;color:#92400e">モンスター:</span> 図鑑とモンスター切り替え
</div>
<div style="background:linear-gradient(135deg,#faf5ff,#f3e8ff);border-left:4px solid #8b5cf6;padding:12px;border-radius:5px">
<span style="font-weight:bold;color:#5b21b6">顔マスク:</span> プライバシー保護設定
</div>
<div style="background:linear-gradient(135deg,#fef2f2,#fee2e2);border-left:4px solid #ef4444;padding:12px;border-radius:5px">
<span style="font-weight:bold;color:#991b1b">カメラOFF:</span> カメラのON/OFF切り替え
</div>
</div>
</div>

<div style="text-align:center;margin-top:30px">
<button onclick="closeHowToPlay();startGame()" style="padding:15px 50px;background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff;border:none;border-radius:10px;font-size:1.2rem;font-weight:bold;cursor:pointer;box-shadow:0 4px 15px rgba(34,197,94,0.4);transition:transform 0.2s" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">さあ、始めよう</button>
</div>
</div>
</div>
